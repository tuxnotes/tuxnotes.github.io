---
layout: post
title: monitoring with pormetheus
date: 2020-09-23
author: tux
tags: prometheus
---
# 1 监控简介

## 1.1 什么是监控

从技术角度看，监控是衡量和管理技术系统的工具和流程。监控将系统和应用程序生产的
指标转换为对应的业务价值。将指标转化为衡量用户体验的依据，该依据为业务提供反馈，以确保为客户提供了所需的产品。同时还提供了对技术的反馈，指出哪些组件不起作用或
导致服务质量下降。

实际上监控系统有如下两个“客户”:

- 技术
- 业务

### 1.1.1 技术作为客户

监控系统的第一个客户是技术，是运维工程师、devops或是SRE需要面对的。通过监控系统
了解技术环境，帮助检测、诊断和解决技术环境中的故障和问题。

Google SRE手册中有一个很棒的图标，显示了监控是构建和管理应用程序层次结构的基础。

### 1.1.2 业务作为客户

监控系统是为了支持业务，并确保业务持续开展。监控可以提供报告，是企业能进行良好的
产品和技术投资。还有助于企业衡量技术带来的价值。

## 1.2 监控基础知识

监控是管理机车设施和业务的核心工具。监控也是必须的，应该和应用程序一起构建和部署。

- 事后监控：监控与安全性一样，也是应用程序的核心功能。务必把应用程序的每个组件的监控指标考虑进来，千万不能等到项目结束或部署之前再做这件事。
- 机械式监控：常见的例子是只监控每台主机上的基础资源，二不监控主机上应用程序是否正常运行的关键服务。
- 不够准确的监控：如通过检查HTTP 200状态码来确定程序是否正常运行，这种方式只会告诉你应用程序正在响应请求，但不会反映出是否返回来正确但数据。因此要监控食物但内容和速率，二不是监控它运行但web服务器但运行时间
- 静态监控：使用静态阈值。为了更好地监控，需要查看数据窗口，而不是静态但时间点，需要使用只能但技术来分析指标和阈值
- 不频繁但监控：设置监控周期是一项挑战，但需要牢记但是存储足够多但历史数据可以有效地识别性能但问题和趋势。
- 缺少自动化或自服务：监控系统但实施和部署应尽可能但自动化

**良好的监控系统应能提供以下内容**：

- 全局视角，从最高曾（业务）依次展开。
- 协助故障诊断
- 作为基础设施、应用程序开发和业务人员的信息源
- 内置于应用程序设计、开发和部署的生命周期中
- 尽可能自动化， 并提供自服务

## 1.3 监控机制

### 1.3.1 探针和内省

监控应用程序主要有两种方法：探针(probing)和内省(introspection)。

**探针**:在应用程序外部，查询应用程序的外部特征：监听端口是否有响应并返回正确的数据或状态码。探针监控的一个例子是执行ICMP检查并确认可以收到响应。Nagios就是一个主要基于探针监控的监控系统。

**内省监控**：查看应用程序内部的内容。应用程序经过检测，并返回其状态、内部组件，或事物和四件性能的量度。这些数据可准确显示应用程序的运行方式，而不仅是其可用性或表面行为。内省监控可直接将事件、日志和指标发送到监控工具，也可将信息发送给状态或健康检查接口，然后由监控工具收集。


